name: Run Selenium Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    # Шаг 1: Получить код
    - name: Checkout repository
      uses: actions/checkout@v3
    
    # Шаг 2: Установить Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    # Шаг 3: Установить зависимости Python
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        # Устанавливаем всё что нужно
        pip install selenium pytest pytest-html webdriver-manager
        # Если есть requirements.txt, тоже установим
        if [ -f "requirements.txt" ]; then
          pip install -r requirements.txt
        fi
    
    # Шаг 4: Установить Chrome (упрощённая версия)
    - name: Install Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y wget
        
        # Установка Chrome
        wget -q -O /tmp/chrome.deb https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo apt-get install -y /tmp/chrome.deb
    
    # Шаг 5: ПРОВЕРКА перед запуском тестов
    - name: Debug and verify
      run: |
        echo "=== Проверка установки ==="
        python --version
        pip list | grep -E "selenium|pytest|webdriver"
        echo ""
        echo "=== Проверка файлов ==="
        ls -la *.py
        echo ""
        echo "=== Тест импорта ==="
        python -c "
        try:
            from selenium import webdriver
            from selenium.webdriver.chrome.service import Service
            from webdriver_manager.chrome import ChromeDriverManager
            import pytest
            print('✅ Все импорты работают')
        except Exception as e:
            print(f'❌ Ошибка импорта: {e}')
        "
        echo ""
        echo "=== Попытка запуска pytest ==="
        python -m pytest test_positive_scenario.py --collect-only 2>&1 || echo "Exit code: $?"
    
    # Шаг 6: Запустить тесты
    - name: Run tests
      run: |
        # Запускаем тесты с выводом максимальной информации
        python -m pytest test_positive_scenario.py test_negative_scenario.py -v --tb=short --html=report.html
    
